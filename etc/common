# grima

GRIMA_HOME=${TOPLEVEL:=${GRIMA_HOME}}
GRIMA_HOME=$(cd ${GRIMA_HOME}; pwd)
export GRIMA_HOME

GRIMA_BIN=${GRIMA_HOME}/bin
export GRIMA_BIN

GRIMA_ETC=${GRIMA_HOME}/etc
export GRIMA_ETC

GRIMA_LIB=${GRIMA_HOME}/lib
export GRIMA_LIB

GRIMA_SRC=${GRIMA_HOME}/src
export GRIMA_SRC

GRIMA_VAR=${GRIMA_HOME}/var
export GRIMA_VAR

GRIMA_DB=${GRIMA_VAR}/db
export GRIMA_DB

GRIMA_LOG=${GRIMA_VAR}/log
export GRIMA_LOG

GRIMA_RUN=${GRIMA_VAR}/run
export GRIMA_RUN

GRIMA_WWW=${GRIMA_HOME}/www
export GRIMA_WWW

GRIMA_CONFIGUREFLAGS="--prefix=${GRIMA_HOME}" 
export GRIMA_CONFIGUREFLAGS

LOGFILE=${GRIMA_LOG}/grima.log
export LOGFILE

function record
{
	date		>> ${LOGFILE}
	echo "$1"	>> ${LOGFILE}
}

function recorde
{
	record	"$1"
	echo	"$1"
}

GRIMA_DEPENDS="                 \
	binutils		\
	gcc			\
	swig			\
	cairo			\
	glib			\
	atk			\
	pango			\
	gtk+			\
	libglade		\
	python			\
	ant			\
	java			\
	netbeans		\
	dbxml			\
	nttcp			\
	pcre			\
	lighttpd		\
	openssl		        \
	neon		        \
	subversion		\
"

# native

PATH=${GRIMA_BIN}:${PATH}
export PATH

PATH=/sbin:/usr/sbin:${PATH}
export PATH

LD_LIBRARY_PATH=${GRIMA_LIB}:${LD_LIBRARY_PATH}
export LD_LIBRARY_PATH

for x in ${GRIMA_DEPENDS}; do
	[ ! -d /opt/${x} ] && continue

	PATH="/opt/${x}/bin:/opt/${x}/sbin:${PATH}"
	export PATH

	LD_LIBRARY_PATH="/opt/${x}/lib:${LD_LIBRARY_PATH}"
	export LD_LIBRARY_PATH
done

SVNHOST=dev.creativedigitalsys.com

SVN=$(which svn)
SVNFLAGS=

CC=$(which gcc)
export CC

CFLAGS=${CFLAGS:="-O0 -std=gnu99 -Wall -Werror"}

if [ ! "${DEBUG}" = "" ]; then
	CFLAGS="${CFLAGS} -g"
fi

export CFLAGS

MAKE=$(which make)
export MAKE

MAKEFLAGS=${MAKEFLAGS:="-k"}
export MAKEFLAGS

SWIG=$(which swig)
export SWIG

SWIGFLAGS=
export SWIGFLAGS

# python

PYTHON="$(which python)"
export PYTHON

PYTHONFLAGS="-tt"
export PYTHONFLAGS

PYTHONPATH=${LD_LIBRARY_PATH}:${PYTHONPATH}
PYTHONPATH=${GRIMA_LIB}:${GRIMA_LIB}/python:${PYTHONPATH}
export PYTHONPATH

for x in ${GRIMA_DEPENDS}; do
	[ ! -d /opt/${x} ] && continue

	PYTHONPATH=/opt/${x}/lib:/opt/${x}/lib/python:${PYTHONPATH}
	export PYTHONPATH
done

# java

CLASSPATH=

for p in ${GRIMA_HOME}/dist/*.jar ${GRIMA_HOME}/lib/java/*.jar; do
	CLASSPATH="${p}:${CLASSPATH}"
        export CLASSPATH
done

for x in ${GRIMA_DEPENDS}; do
	[ ! -d /opt/${x} ] && continue

	for p in /opt/${x}/lib/*.jar; do
		CLASSPATH="${p}:${CLASSPATH}"
                export CLASSPATH
	done
done

CLASSPATH="${CLASSPATH}:/usr/share/java/commons-cli.jar"
CLASSPATH="${CLASSPATH}:/usr/share/java/commons-daemon.jar"

CLASSPATH="${CLASSPATH}:/opt/netbeans-6.0/java1/modules/ext/AbsoluteLayout.jar"
CLASSPATH="${CLASSPATH}:/opt/netbeans-6.0/platform7/modules/ext/swing-layout-1.0.3.jar"
CLASSPATH="${CLASSPATH}:/opt/netbeans-6.0/java1/modules/ext/junit-4.1.jar"

export CLASSPATH

XXX="${JAVA_HOME}"

# Debian/Ubuntu & Fedora Core x86
XXX="${XXX} /usr/lib/jvm/java-6-sun"

# Debian/Ubuntu & Fedora Core ppc
XXX="${XXX} /usr/lib/j2sdk1.6-ibm"

# Yellowdog 3/4
XXX="${XXX} /opt/java"

for x in ${XXX}; do
	[ ! -d ${x} ] && continue

	JAVA_HOME=${x}
	export JAVA_HOME

	break
done

PATH=${JAVA_HOME}/bin:${PATH}
export PATH

JAVA=$(which java)
export JAVA

JAVAFLAGS=
JAVAFLAGS="${JAVAFLAGS} -Dgrima.home=${GRIMA_HOME}"
JAVAFLAGS="${JAVAFLAGS} -Djava.library.path=${LD_LIBRARY_PATH}"
JAVAFLAGS="${JAVAFLAGS} \
	-Djava.util.logging.config.file=${GRIMA_ETC}/grima.properties"

if [ ! "${DEBUG}" = "" ]; then
	JAVAFLAGS="${JAVAFLAGS}"
	# JAVAFLAGS="${JAVAFLAGS} -Dcom.sun.management.jmxremote"
	# JAVAFLAGS="${JAVAFLAGS} -Xdebug -agentlib:jdwp=transport=dt_socket,server=y,address=8000"
fi

export JAVAFLAGS

ANT=$(which ant)
export ANT

ANTFLAGS="-Dplatform.home=\"${JAVA_HOME}\" -emacs"

if [ ! "${DEBUG}" = "" ]; then
	ANTFLAGS="${ANTFLAGS} -Djavac.debug=true"
fi

export ANTFLAGS

JSVC= # TODO: $(which jsvc)
export JSVC

JSVCFLAGS=
JSVCFLAGS="${JSVCFLAGS} ${JAVAFLAGS}"
JSVCFLAGS="${JSVCFLAGS} -cp ${CLASSPATH} -user ${USER}"
export JSVCFLAGS

NETBEANS=$(which netbeans)
export NETBEANS

NETBEANSFLAGS=
export NETBEANSFLAGS

# extras

GRIMA_EXTRAS="		        \
        Elrond                  \
"

for x in ${GRIMA_EXTRAS}; do
	TOPLEVEL=${GRIMA_HOME}/extras/${x}
	. ${TOPLEVEL}/etc/common
done
